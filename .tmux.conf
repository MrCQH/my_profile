# ==================== 基础设置 ====================
# 将前缀键改为 Ctrl-a（更顺手，Screen 用户习惯）
set -g prefix C-a
unbind C-b
bind C-a send-prefix
set -s set-clipboard external
setw -g mode-keys vi

# 支持真彩色（现代终端必需）
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# 从 1 开始编号窗口和 pane（键盘上排更方便）
set -g base-index 1
setw -g pane-base-index 1

# 自动重命名窗口（根据当前命令）
setw -g automatic-rename on
set -g renumber-windows on

# 增加历史记录限制（默认 2000，太少）
set -g history-limit 100000

# 缩短命令延迟（提升 Vim 等响应速度）
set -sg escape-time 10

# ==================== 鼠标支持 ====================
set -g mouse on
# 允许在 copy-mode 中用鼠标直接选中（默认已支持，但加强）
bind -T copy-mode-vi MouseDrag1Pane send -X begin-selection
bind -T copy-mode-vi MouseDown1Pane send -X clear-selection

# 双击选中单词，三击选中行（可选，超级实用）
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send -X select-word
bind -T copy-mode-vi TripleClick1Pane select-pane \; send -X select-line
# 鼠标滚轮行为优化（复制模式下更好用）
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"

# ==================== 键绑定优化 ====================
# Vim 风格的 pane 切换（前缀 + h/j/k/l）
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vim 风格的 pane 分割
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"

# Vim 风格的窗口切换
bind -r C-h previous-window
bind -r C-l next-window

# 快速重载配置
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# 复制模式使用 Vim 键位
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# ==================== 状态栏美化 ====================
set -g status on
set -g status-interval 1
set -g status-justify centre

# 左侧：session 名
set -g status-left-length 50
set -g status-left "#[fg=green][#S] #[fg=yellow]#I:#P "

# 右侧：时间、日期、主机
set -g status-right-length 50
set -g status-right "#[fg=cyan]%Y-%m-%d %H:%M #[fg=magenta]#H"

# 窗口列表样式
setw -g window-status-format " #I:#W#F "
setw -g window-status-current-format "#[bold] #I:#W#F "
setw -g window-status-current-style fg=brightwhite,bg=blue

# 整体状态栏颜色
set -g status-style fg=white,bg=black

# Vi-style copy mode (optional but recommended)
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"

# Mouse drag also copies to clipboard
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"
